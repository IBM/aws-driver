AWSTemplateFormatVersion: 2010-09-09
Description: Transit Gateway Route Table Attachment and Association for Transit Gateway {{ transit_gateway_id }} and Subnet {{ subnet_id }}.

# this is created only when public_private != 'public' - see resourcedriver createtgwroutetableassociation

Resources:
  TransitGatewayAttachment:
    Type: AWS::EC2::TransitGatewayVpcAttachment
    Properties:
      SubnetIds:
        - {{ subnet_id }}
      TransitGatewayId: {{ transit_gateway_id }}
      VpcId: {{ vpc_id }}
  TransitGatewayAttachmentAssociation:
    Type: AWS::EC2::TransitGatewayRouteTableAssociation
    Properties:
      TransitGatewayAttachmentId: !Ref TransitGatewayAttachment
      TransitGatewayRouteTableId: {{transit_route_table_id}}
  {% if global_route == 'true' %}
  TransitGatewayRoute:
    Type: AWS::EC2::TransitGatewayRoute
    Properties:
      Blackhole: false
      DestinationCidrBlock: 0.0.0.0/0
      TransitGatewayAttachmentId: !Ref TransitGatewayAttachment
      TransitGatewayRouteTableId: {{transit_route_table_id}}
  {% endif %}
Outputs:
  {{ vpc_id | replace("-","") + "TGWATTACHID"}}:
    Description: A reference to the created Transit Gateway Attachment
    Value: !Ref TransitGatewayAttachment
